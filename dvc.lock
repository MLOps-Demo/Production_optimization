schema: '2.0'
stages:
  create-dataset:
    cmd: python src/create_dataset.py
    deps:
    - path: data/raw_dataset/clean_data.csv
      md5: f0cd8ff9e7cd4a7e86ab7074c7055dab
      size: 199942
    - path: src/config.py
      md5: 952fc933b8732c5ff54c7683cec8089b
      size: 499
    - path: src/create_dataset.py
      md5: 50cc88f97b5cb5e87c5c443fd9ba7e6d
      size: 845
    outs:
    - path: data/cleaned_data/dataset.csv
      md5: 6e032aac042ee4bbd4b47ca55fa02af9
      size: 199998
  anomaly-detect:
    cmd: python src/anomaly_detect.py
    deps:
    - path: data/cleaned_data/dataset.csv
      md5: 6e032aac042ee4bbd4b47ca55fa02af9
      size: 199998
    - path: src/anomaly_detect.py
      md5: 51013a4016a63cadc07ef7df4780c310
      size: 6373
    - path: src/config.py
      md5: 952fc933b8732c5ff54c7683cec8089b
      size: 499
    params:
      params.yaml:
        anomaly_detect.anomaly_contamination: 0.005
        anomaly_detect.seed: 25
    outs:
    - path: data/anomaly_treated/anomaly_treated_data.csv
      md5: 966b7e7b1b1ec44a1e028478bf4be565
      size: 198691
    - path: data/plots_figs/anomaly_detect_plt_pca.png
      md5: 749462307794d14638c9e83eda31409f
      size: 160061
    - path: data/plots_figs/anomaly_detect_plt_tsne.png
      md5: 3939dd691a78a77644c1d9a4275ba126
      size: 158007
  data-split:
    cmd: python src/data_split.py
    deps:
    - path: data/anomaly_treated/anomaly_treated_data.csv
      md5: 966b7e7b1b1ec44a1e028478bf4be565
      size: 198691
    - path: src/config.py
      md5: 952fc933b8732c5ff54c7683cec8089b
      size: 499
    - path: src/data_split.py
      md5: eaad548eed77478c1236bd1645b6a444
      size: 1257
    params:
      params.yaml:
        data-split.seed: 42
        data-split.split: 0.2
    outs:
    - path: data/features/x_test.npy
      md5: 5daf756a971eb819e073b16172f59347
      size: 23232
    - path: data/features/x_train.npy
      md5: 9625f5b8fbd3f4bc4b47e9bf94e76cd4
      size: 92544
    - path: data/features/y_test.npy
      md5: 6354aae4a7374ba9e9a2831da56d45ba
      size: 3016
    - path: data/features/y_train.npy
      md5: f3b4c4795e79fde5794f543b93752b12
      size: 11680
  normalize:
    cmd: python src/normalize.py
    deps:
    - path: data/features/x_test.npy
      md5: 5daf756a971eb819e073b16172f59347
      size: 23232
    - path: data/features/x_train.npy
      md5: 9625f5b8fbd3f4bc4b47e9bf94e76cd4
      size: 92544
    - path: src/config.py
      md5: 952fc933b8732c5ff54c7683cec8089b
      size: 499
    - path: src/normalize.py
      md5: 778bdb4b6ef651f30c4857affe3778c4
      size: 741
    outs:
    - path: data/models/scaling_model.pkl
      md5: c3e6d84097c8cc032f98f279991b53bb
      size: 641
  training:
    cmd: python src/training.py
    deps:
    - path: data/features/x_train.npy
      md5: 9625f5b8fbd3f4bc4b47e9bf94e76cd4
      size: 92544
    - path: data/features/y_train.npy
      md5: f3b4c4795e79fde5794f543b93752b12
      size: 11680
    - path: data/models/scaling_model.pkl
      md5: c3e6d84097c8cc032f98f279991b53bb
      size: 641
    - path: src/config.py
      md5: 952fc933b8732c5ff54c7683cec8089b
      size: 499
    - path: src/learning_curves.py
      md5: 841fbd4d73f7ccdce9062de33508cf99
      size: 4007
    - path: src/training.py
      md5: c7a7217e494adbec88ba701967384bbc
      size: 1996
    params:
      params.yaml:
        training.lr: 0.02
        training.m_depth: 4
        training.min_leaf: 5
        training.min_split: 6
        training.n_est: 100
    outs:
    - path: data/models/gbrt_model.pkl
      md5: 774b670a15515cc5ea50acc43c3af435
      size: 209441
    - path: data/plots_figs/learning_curve.png
      md5: 863d591b80c81ca1ea9da17f1bc2cdf9
      size: 87780
  evaluate:
    cmd: python src/evaluate.py
    deps:
    - path: data/features/x_test.npy
      md5: 5daf756a971eb819e073b16172f59347
      size: 23232
    - path: data/features/y_test.npy
      md5: 6354aae4a7374ba9e9a2831da56d45ba
      size: 3016
    - path: data/models/gbrt_model.pkl
      md5: 774b670a15515cc5ea50acc43c3af435
      size: 209441
    - path: data/models/scaling_model.pkl
      md5: c3e6d84097c8cc032f98f279991b53bb
      size: 641
    - path: src/config.py
      md5: 952fc933b8732c5ff54c7683cec8089b
      size: 499
    - path: src/evaluate.py
      md5: 0806cab9a76b63651d3f11ce66f932b8
      size: 1559
    outs:
    - path: data/plots_figs/deviance.png
      md5: 4bc4bd8ef5158b4e0cca4a3d051593b6
      size: 35385
    - path: data/plots_figs/feature_importance.png
      md5: 20a9c5dbee9763d7c739bc01f74f8a03
      size: 48162
    - path: data/predictions/prediction.csv
      md5: da30f0c4388bf9fefe4cde899290005c
      size: 8981
    - path: scores.json
      md5: 5ce6fda9d0fd717ad7ee1e7d8e4dd4c3
      size: 67
