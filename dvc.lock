schema: '2.0'
stages:
  create-dataset:
    cmd: python src/create_dataset.py
    deps:
    - path: data/original_dataset/clean_data.csv
      md5: f0cd8ff9e7cd4a7e86ab7074c7055dab
      size: 199942
    - path: src/config.py
      md5: fb091cc52a55961ad7794da791d7471f
      size: 509
    - path: src/create_dataset.py
      md5: c1c09dfbf2072937befc14bbad1637f3
      size: 986
    outs:
    - path: data/cleaned_data/dataset.csv
      md5: 6e032aac042ee4bbd4b47ca55fa02af9
      size: 199998
  anomaly-detect:
    cmd: python src/anomaly_detect.py
    deps:
    - path: data/cleaned_data/dataset.csv
      md5: 6e032aac042ee4bbd4b47ca55fa02af9
      size: 199998
    - path: src/anomaly_detect.py
      md5: 0cb027c21d4235d7bf28b232fb0972e1
      size: 7095
    - path: src/config.py
      md5: fb091cc52a55961ad7794da791d7471f
      size: 509
    params:
      params.yaml:
        anomaly_detect.anomaly_contamination: 0.002
        anomaly_detect.seed: 36
    outs:
    - path: anomaly_summary.json
      md5: 342f7f60907bf8de69458305a4192c0a
      size: 97
    - path: data/anomaly_treated/anomalous_data.csv
      md5: 6df4013ce664665d666897b4ac66adc1
      size: 696
    - path: data/anomaly_treated/anomaly_treated_data.csv
      md5: 83afaae7762a7c27f131f1fe93ba8f0c
      size: 199447
    - path: data/plots_figs/anomaly_detect_plt_pca.png
      md5: db6e2a6ca717199866401c0ba8d48c21
      size: 157427
    - path: data/plots_figs/anomaly_detect_plt_tsne.png
      md5: 4773ba48d7a9efbfead05ddc3aab4187
      size: 154787
  data-split:
    cmd: python src/data_split.py
    deps:
    - path: data/anomaly_treated/anomaly_treated_data.csv
      md5: 83afaae7762a7c27f131f1fe93ba8f0c
      size: 199447
    - path: src/config.py
      md5: fb091cc52a55961ad7794da791d7471f
      size: 509
    - path: src/data_split.py
      md5: eaad548eed77478c1236bd1645b6a444
      size: 1257
    params:
      params.yaml:
        data-split.seed: 42
        data-split.split: 0.2
    outs:
    - path: data/features/x_test.npy
      md5: dca698e09d59076d9c1a8bddc0e20e46
      size: 23360
    - path: data/features/x_train.npy
      md5: cd414cb37bf60b63c6a67d2f9b3063a2
      size: 92864
    - path: data/features/y_test.npy
      md5: 9402d86e6fa653429122c1b454157fc9
      size: 3032
    - path: data/features/y_train.npy
      md5: 2e7c53b26ba2552dfc4138a3c964798c
      size: 11720
  normalize:
    cmd: python src/normalize.py
    deps:
    - path: data/features/x_test.npy
      md5: dca698e09d59076d9c1a8bddc0e20e46
      size: 23360
    - path: data/features/x_train.npy
      md5: cd414cb37bf60b63c6a67d2f9b3063a2
      size: 92864
    - path: src/config.py
      md5: fb091cc52a55961ad7794da791d7471f
      size: 509
    - path: src/normalize.py
      md5: 778bdb4b6ef651f30c4857affe3778c4
      size: 741
    outs:
    - path: data/models/scaling_model.pkl
      md5: 6d34d2b3a6b729214d7a06772d1b8200
      size: 641
  training:
    cmd: python src/training.py
    deps:
    - path: data/features/x_train.npy
      md5: cd414cb37bf60b63c6a67d2f9b3063a2
      size: 92864
    - path: data/features/y_train.npy
      md5: 2e7c53b26ba2552dfc4138a3c964798c
      size: 11720
    - path: data/models/scaling_model.pkl
      md5: 6d34d2b3a6b729214d7a06772d1b8200
      size: 641
    - path: src/config.py
      md5: fb091cc52a55961ad7794da791d7471f
      size: 509
    - path: src/learning_curves.py
      md5: 6ba77068b0d427393851d60621db8330
      size: 4009
    - path: src/training.py
      md5: 538f5b534aba16fe527b666c29e4cb12
      size: 2032
    params:
      params.yaml:
        training.lr: 0.02
        training.m_depth: 5
        training.min_leaf: 6
        training.min_split: 5
        training.n_est: 100
    outs:
    - path: data/models/gbrt_model.pkl
      md5: 31c98aac8324792de09495714cce192a
      size: 338015
    - path: data/plots_figs/learning_curve.png
      md5: 0ecc71c5108a675dcbccb530a9173f4b
      size: 221841
  evaluate:
    cmd: python src/evaluate.py
    deps:
    - path: data/features/x_test.npy
      md5: dca698e09d59076d9c1a8bddc0e20e46
      size: 23360
    - path: data/features/y_test.npy
      md5: 9402d86e6fa653429122c1b454157fc9
      size: 3032
    - path: data/models/gbrt_model.pkl
      md5: 31c98aac8324792de09495714cce192a
      size: 338015
    - path: data/models/scaling_model.pkl
      md5: 6d34d2b3a6b729214d7a06772d1b8200
      size: 641
    - path: src/config.py
      md5: fb091cc52a55961ad7794da791d7471f
      size: 509
    - path: src/evaluate.py
      md5: 034d0c8d082cd72d09030b8025cef71d
      size: 1581
    outs:
    - path: data/plots_figs/deviance.png
      md5: b1725a665dac89f5b555647e771c03a0
      size: 53755
    - path: data/plots_figs/feature_importance.png
      md5: 707496c2bb2ff6d23c0c7030923b01d5
      size: 68673
    - path: data/predictions/prediction.csv
      md5: dd746267751c665013580ee37418b010
      size: 9005
    - path: scores.json
      md5: b1afa0bd1f288cccadfe7e00e22b7b3a
      size: 67
